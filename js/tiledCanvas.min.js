function TiledCanvas(a,h,f,g){if((this instanceof TiledCanvas)===false){return new TiledCanvas(a)}var e={},b={tile:{width:100,height:100}},d=0,j;function i(n,l,p,k,q){if((this instanceof i)===false){return new i(n,l,p,k,q)}var o=document.createElement("canvas"),m=o.getContext("2d");p=parseInt(p,10);k=parseInt(k,10);n=parseInt(n,10);l=parseInt(l,10);q=parseInt(q,10);if(p<=0||k<=0){throw new Error("Width and height of canvas tile must be positive")}o.setAttribute("width",p);o.setAttribute("height",k);o.style.width=p+"px";o.style.height=k+"px";o.style.position="absolute";o.style.padding=0;o.style.left=n+"px";o.style.top=l+"px";o.style.zIndex=q;this.drawImage=function(x,t,w,v,s,z,y,r,u){if(z===undefined&&y===undefined&&r===undefined&&u===undefined){t-=Math.abs(n);w-=Math.abs(l);m.drawImage(x,0,0,x.naturalWidth,x.naturalHeight,t,w,v,s)}else{z-=Math.abs(n);y-=Math.abs(l);m.drawImage(x,(v>x.naturalWidth)?x.naturalWidth:v,(s>x.naturalHeight)?x.naturalHeight:s,v,s,z,y,r,u)}return this};this.clearRect=function(r,u,s,t){r-=Math.abs(n);u-=Math.abs(l);m.clearRect(r,u,s,t)};this.getCanvas=function(){return o};this.getCtx=function(){return m}}function c(l,k,p,q,o){if((this instanceof c)===false){return new c(l,k,p,q,o)}if((l instanceof HTMLElement)===false){throw new Error("Container must be an instance of HTMLElement")}if(typeof k!=="string"||k.length===0){throw new Error("Invalid name of the Layer: "+k)}if(q===undefined){q=100}if(o===undefined){o=100}p=parseInt(p,10);q=parseInt(q,10);o=parseInt(o,10);if(q<=0||o<=0){throw new Error("Width and height of the tile must be positive")}if(l.style.position==="static"||l.style.position===""){l.style.position="relative"}l.style.overflow="hidden";var u={x:Math.ceil(l.clientWidth/q),y:Math.ceil(l.clientHeight/o)},t=[],n=0,m=0,s=u.x,r=u.y;for(m=0;m<r;m++){for(n=0;n<s;n++){if(t===undefined){t=[]}if(t[m]===undefined){t[m]=[]}if(t[m][n]===undefined){t[m][n]=[]}t[m][n]=new i(n*q,m*o,q,o,p);l.appendChild(t[m][n].getCanvas())}}this.destroy=function(){for(m=0;m<r;m++){for(n=0;n<s;n++){if(t===undefined){t=[]}if(t[m]===undefined){t[m]=[]}if(t[m][n]===undefined){t[m][n]=[]}l.removeChild(t[m][n])}}return this};this.getTilesToDraw=function(F,D,G,B){var E=[0,0],C=[0,0],A=0,z=0,v=[];E=[Math.floor(F/q),Math.floor(D/o)];C=[Math.floor((F+G)/q),Math.floor((D+B)/o)];switch(true){case (E[0]===C[0]&&E[1]===C[1]):if(this.tileExist(E[0],E[1])){v.push(t[E[1]][E[0]])}break;case (E[0]===C[0]):for(A=E[1];A<=C[1];A++){if(this.tileExist(E[0],A)){v.push(t[A][E[0]])}}break;case (E[1]===C[1]):for(A=E[0];A<=C[0];A++){if(this.tileExist(A,E[1])){v.push(t[E[1]][A])}}break;default:for(z=E[1];z<=C[1];z++){for(A=E[0];A<=C[0];A++){if(this.tileExist(A,z)){v.push(t[z][A])}}}}return v};this.tileExist=function(v,w){if(t[w]!==undefined&&(t[w][v] instanceof i)===true){return true}return false};this.drawImage=function(E,z,D,C,x,G,F,v,B){var w,y=0,A=0;if(C===undefined&&x===undefined){C=E.naturalWidth;x=E.naturalHeight}if(G===undefined&&F===undefined&&v===undefined&&B===undefined){z=parseInt(z,10);D=parseInt(D,10);C=parseInt(C,10);x=parseInt(x,10);w=this.getTilesToDraw(z,D,C,x)}else{G=parseInt(G,10);F=parseInt(F,10);v=parseInt(v,10);B=parseInt(B,10);w=this.getTilesToDraw(G,F,v,B)}A=w.length;for(y=0;y<A;y++){w[y].drawImage(E,z,D,C,x,G,F,v,B)}return this};this.clearRect=function(v,E,A,C){var z,B=0,D=0;z=this.getTilesToDraw(v,E,A,C);D=z.length;for(B=0;B<D;B++){z[B].clearRect(v,E,A,C)}return this}}this.addLayer=function(l,n,m,k){if(typeof l!=="string"||l.length===0){throw new Error("Invalid name of the Layer: "+l)}if((e[l] instanceof c)===true){e[l].destroy();delete e[l]}if(n===undefined){d+=1;n=d}else{n=parseInt(n,10);if(d<n){d=n}}e[l]=new c(a,l,n,(m===undefined)?b.tile.width:m,(k===undefined)?b.tile.height:k);if(n===d){j=e[l]}return this};this.getLayer=function(k){return((e[k] instanceof c)===false)?e:e[k]};this.drawImage=function(q,m,p,o,l,s,r,k,n){if((j instanceof c)===false){throw new Error("No layers in this canvas, add at least one layer")}j.drawImage(q,m,p,o,l,s,r,k,n)};this.clearRect=function(k,n,l,m){if((j instanceof c)===false){throw new Error("No layers in this canvas, add at least one layer")}j.clearRect(k,n,l,m)};if((a instanceof HTMLElement)===false){throw new Error("Container must be an instance of HTMLElement")}if(h!==undefined&&f!==undefined){h=parseInt(h,10);f=parseInt(f,10);if(h>0&&f>0){this.addLayer("default",parseInt(g,10),h,f)}}};