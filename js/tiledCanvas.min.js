function TiledCanvas(a){if((this instanceof TiledCanvas)===false){return new TiledCanvas(a)}var e={},g={tile:{width:100,height:100}},d=0,c;function b(k,i,m,h,n){if((this instanceof b)===false){return new b(k,i,m,h,n)}var l=document.createElement("canvas"),j=l.getContext("2d");m=parseInt(m,10);h=parseInt(h,10);k=parseInt(k,10);i=parseInt(i,10);n=parseInt(n,10);if(m<=0||h<=0){throw new Error("Width and height of canvas tile must be positive")}l.setAttribute("width",m);l.setAttribute("height",h);l.style.width=m+"px";l.style.height=h+"px";l.style.position="absolute";l.style.padding=0;l.style.left=k+"px";l.style.top=i+"px";l.style.zIndex=n;this.drawImage=function(u,q,t,s,p,w,v,o,r){if(w===undefined&&v===undefined&&o===undefined&&r===undefined){q-=Math.abs(k);t-=Math.abs(i);j.drawImage(u,0,0,u.naturalWidth,u.naturalHeight,q,t,s,p)}else{w-=Math.abs(k);v-=Math.abs(i);j.drawImage(u,(s>u.naturalWidth)?u.naturalWidth:s,(p>u.naturalHeight)?u.naturalHeight:p,s,p,w,v,o,r)}return this};this.clearRect=function(o,r,p,q){o-=Math.abs(k);r-=Math.abs(i);j.clearRect(o,r,p,q)};this.getCanvas=function(){return l};this.getCtx=function(){return j}}function f(k,h,o,p,n){if((this instanceof f)===false){return new f(k,h,o,p,n)}if((k instanceof HTMLElement)===false){throw new Error("Container must be an instance of HTMLElement")}if(typeof h!=="string"||h.length===0){throw new Error("Invalid name of the Layer: "+h)}if(p===undefined){p=100}if(n===undefined){n=100}o=parseInt(o,10);p=parseInt(p,10);n=parseInt(n,10);if(p<=0||n<=0){throw new Error("Width and height of the tile must be positive")}if(k.style.position==="static"||k.style.position===""){k.style.position="relative"}k.style.overflow="hidden";var t={x:Math.ceil(k.clientWidth/p),y:Math.ceil(k.clientHeight/n)},s=[],m=0,l=0,r=t.x,q=t.y;for(l=0;l<q;l++){for(m=0;m<r;m++){if(s===undefined){s=[]}if(s[l]===undefined){s[l]=[]}if(s[l][m]===undefined){s[l][m]=[]}s[l][m]=new b(m*p,l*n,p,n,o);k.appendChild(s[l][m].getCanvas())}}this.destroy=function(){for(l=0;l<q;l++){for(m=0;m<r;m++){if(s===undefined){s=[]}if(s[l]===undefined){s[l]=[]}if(s[l][m]===undefined){s[l][m]=[]}k.removeChild(s[l][m])}}return this};this.drawImage=function(E,y,D,C,v,G,F,u,A){var B=[0,0],z=[0,0],x=0,w=0;if(C===undefined&&v===undefined){C=E.naturalWidth;v=E.naturalHeight}if(G===undefined&&F===undefined&&u===undefined&&A===undefined){y=parseInt(y,10);D=parseInt(D,10);C=parseInt(C,10);v=parseInt(v,10);B=[Math.floor(y/p),Math.floor(D/n)];z=[Math.ceil((y+C)/p),Math.ceil((D+v)/n)]}else{G=parseInt(G,10);F=parseInt(F,10);u=parseInt(u,10);A=parseInt(A,10);B=[Math.floor(G/p),Math.floor(F/n)];z=[Math.floor((G+u)/p),Math.floor((F+A)/n)]}if(B[0]===z[0]&&B[1]===z[1]){if((s[B[0]]!==undefined)&&(s[B[0]][B[1]] instanceof b)===true){s[B[0]][B[1]].drawImage(E,y,D,C,v,G,F,u,A)}}else{for(w=B[1];w<z[1];w++){for(x=B[0];x<z[0];x++){if((s[w]!==undefined)&&(s[w][x] instanceof b)===true){s[w][x].drawImage(E,y,D,C,v,G,F,u,A)}}}}return this};this.clearRect=function(u,E,v,C){var B=[0,0],D=[0,0],A=0,z=0;B=[Math.floor(u/p),Math.floor(E/n)];D=[Math.floor((u+v)/p),Math.floor((E+C)/n)];if(B[0]===D[0]&&B[1]===D[1]){if((s[B[0]]!==undefined)&&(s[B[0]][B[1]] instanceof b)===true){s[B[0]][B[1]].clearRect(u,E,v,C)}}else{for(z=B[1];z<D[1];z++){for(A=B[0];A<D[0];A++){if((s[z]!==undefined)&&(s[z][A] instanceof b)===true){s[z][A].clearRect(u,E,v,C)}}}}return this}}if((a instanceof HTMLElement)===false){throw new Error("Container must be an instance of HTMLElement")}this.addLayer=function(i,k,j,h){if(typeof i!=="string"||i.length===0){throw new Error("Invalid name of the Layer: "+i)}if((e[i] instanceof f)===true){e[i].destroy();delete e[i]}if(k===undefined){d+=1;k=d}else{k=parseInt(k,10);if(d<k){d=k}}e[i]=new f(a,i,k,(j===undefined)?g.tile.width:j,(h===undefined)?g.tile.height:h);if(k===d){c=e[i]}return this};this.getLayer=function(h){return((e[h] instanceof f)===false)?e:e[h]};this.drawImage=function(n,j,m,l,i,p,o,h,k){if((c instanceof f)===false){throw new Error("No layers in this canvas, add at least one layer")}c.drawImage(n,j,m,l,i,p,o,h,k)};this.clearRect=function(i,l,j,k){if((c instanceof f)===false){throw new Error("No layers in this canvas, add at least one layer")}c.clearRect(i,l,j,k)}};