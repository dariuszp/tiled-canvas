function TiledCanvas(a){if((this instanceof TiledCanvas)===false){return new TiledCanvas(a)}var d={},f={tile:{width:100,height:100}},c=0;function b(j,h,l,g,m){if((this instanceof b)===false){return new b(j,h,l,g,m)}var k=document.createElement("canvas"),i=k.getContext("2d");l=parseInt(l,10);g=parseInt(g,10);j=parseInt(j,10);h=parseInt(h,10);m=parseInt(m,10);if(l<=0||g<=0){throw new Error("Width and height of canvas tile must be positive")}k.setAttribute("width",l);k.setAttribute("height",g);k.style.width=l+"px";k.style.height=g+"px";k.style.position="absolute";k.style.padding=0;k.style.left=j+"px";k.style.top=h+"px";k.style.zIndex=m;this.drawImage=function(t,p,s,r,o,v,u,n,q){if(v===undefined&&u===undefined&&n===undefined&&q===undefined){p-=j;s-=h;i.drawImage(t,0,0,(r>t.naturalWidth)?t.naturalWidth:r,(o>t.naturalHeight)?t.naturalHeight:o,p,s,r,o)}else{v-=j;u-=h;i.drawImage(t,(r>t.naturalWidth)?t.naturalWidth:r,(o>t.naturalHeight)?t.naturalHeight:o,r,o,v,u,n,q)}};this.getCanvas=function(){return k};this.getCtx=function(){return i}}function e(h,g,n,o,m){if((this instanceof e)===false){return new e(h,g,n,o,m)}if((h instanceof HTMLElement)===false){throw new Error("Container must be an instance of HTMLElement")}if(typeof g!=="string"||g.length===0){throw new Error("Invalid name of the Layer: "+g)}if(o===undefined){o=100}if(m===undefined){m=100}n=parseInt(n,10);o=parseInt(o,10);m=parseInt(m,10);if(o<=0||m<=0){throw new Error("Width and height of the tile must be positive")}if(h.style.position==="static"||h.style.position===""){h.style.position="relative"}h.style.overflow="hidden";var s={x:Math.ceil(h.clientWidth/o),y:Math.ceil(h.clientHeight/m)},r=[],l=0,k=0,q=s.x,p=s.y;for(k=0;k<p;k++){for(l=0;l<q;l++){if(r===undefined){r=[]}if(r[k]===undefined){r[k]=[]}if(r[k][l]===undefined){r[k][l]=[]}r[k][l]=new b(l*o,k*m,o,m,n);h.appendChild(r[k][l].getCanvas())}}this.destroy=function(){for(k=0;k<p;k++){for(l=0;l<q;l++){if(r===undefined){r=[]}if(r[k]===undefined){r[k]=[]}if(r[k][l]===undefined){r[k][l]=[]}h.removeChild(r[k][l])}}};this.drawImage=function(D,x,C,B,u,F,E,t,z){var A=[0,0],y=[0,0],w=0,v=0;if(F===undefined&&E===undefined&&t===undefined&&z===undefined){if(B===undefined&&u===undefined){B=D.clientWidth;u=D.clientHeight}A=[Math.floor(x/o),Math.floor(C/m)];y=[Math.ceil((x+B)/o),Math.ceil((C+u)/m)]}for(v=A[1];v<y[1];v++){for(w=A[0];w<y[0];w++){if((r[v]!==undefined)&&(r[v][w] instanceof b)===true){r[v][w].drawImage(D,x,C,B,u,F,E,t,z)}}}}}if((a instanceof HTMLElement)===false){throw new Error("Container must be an instance of HTMLElement")}this.addLayer=function(h,j,i,g){if(typeof h!=="string"||h.length===0){throw new Error("Invalid name of the Layer: "+h)}if((d[h] instanceof e)===true){d[h].destroy();delete d[h]}if(j===undefined){c+=1;j=c}else{j=parseInt(j,10);if(c<j){c=j}}d[h]=new e(a,h,j,(i===undefined)?f.tile.width:i,(g===undefined)?f.tile.height:g);return this};this.getLayer=function(g){return((d[g] instanceof e)===false)?d:d[g]}};