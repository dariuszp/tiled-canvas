function TiledCanvas(a){if((this instanceof TiledCanvas)===false){return new TiledCanvas(a)}var e={},g={tile:{width:100,height:100}},d=0,c;function b(k,i,m,h,n){if((this instanceof b)===false){return new b(k,i,m,h,n)}var l=document.createElement("canvas"),j=l.getContext("2d");m=parseInt(m,10);h=parseInt(h,10);k=parseInt(k,10);i=parseInt(i,10);n=parseInt(n,10);if(m<=0||h<=0){throw new Error("Width and height of canvas tile must be positive")}l.setAttribute("width",m);l.setAttribute("height",h);l.style.width=m+"px";l.style.height=h+"px";l.style.position="absolute";l.style.padding=0;l.style.left=k+"px";l.style.top=i+"px";l.style.zIndex=n;this.drawImage=function(u,q,t,s,p,w,v,o,r){if(w===undefined&&v===undefined&&o===undefined&&r===undefined){q-=Math.abs(k);t-=Math.abs(i);j.drawImage(u,0,0,u.naturalWidth,u.naturalHeight,q,t,s,p)}else{w-=Math.abs(k);v-=Math.abs(i);j.drawImage(u,(s>u.naturalWidth)?u.naturalWidth:s,(p>u.naturalHeight)?u.naturalHeight:p,s,p,w,v,o,r)}return this};this.clearRect=function(o,r,p,q){o-=Math.abs(k);r-=Math.abs(i);j.clearRect(o,r,p,q)};this.getCanvas=function(){return l};this.getCtx=function(){return j}}function f(k,h,o,p,n){if((this instanceof f)===false){return new f(k,h,o,p,n)}if((k instanceof HTMLElement)===false){throw new Error("Container must be an instance of HTMLElement")}if(typeof h!=="string"||h.length===0){throw new Error("Invalid name of the Layer: "+h)}if(p===undefined){p=100}if(n===undefined){n=100}o=parseInt(o,10);p=parseInt(p,10);n=parseInt(n,10);if(p<=0||n<=0){throw new Error("Width and height of the tile must be positive")}if(k.style.position==="static"||k.style.position===""){k.style.position="relative"}k.style.overflow="hidden";var t={x:Math.ceil(k.clientWidth/p),y:Math.ceil(k.clientHeight/n)},s=[],m=0,l=0,r=t.x,q=t.y;for(l=0;l<q;l++){for(m=0;m<r;m++){if(s===undefined){s=[]}if(s[l]===undefined){s[l]=[]}if(s[l][m]===undefined){s[l][m]=[]}s[l][m]=new b(m*p,l*n,p,n,o);k.appendChild(s[l][m].getCanvas())}}this.destroy=function(){for(l=0;l<q;l++){for(m=0;m<r;m++){if(s===undefined){s=[]}if(s[l]===undefined){s[l]=[]}if(s[l][m]===undefined){s[l][m]=[]}k.removeChild(s[l][m])}}return this};this.getTilesToDraw=function(E,C,F,A){var D=[0,0],B=[0,0],z=0,v=0,u=[];D=[Math.floor(E/p),Math.floor(C/n)];B=[Math.floor((E+F)/p),Math.floor((C+A)/n)];switch(true){case (D[0]===B[0]&&D[1]===B[1]):if(this.tileExist(D[0],D[1])){u.push(s[D[1]][D[0]])}break;case (D[0]===B[0]):for(z=D[1];z<=B[1];z++){if(this.tileExist(D[0],z)){u.push(s[z][D[0]])}}break;case (D[1]===B[1]):for(z=D[0];z<=B[0];z++){if(this.tileExist(z,D[1])){u.push(s[D[1]][z])}}break;default:for(v=D[1];v<=B[1];v++){for(z=D[0];z<=B[0];z++){if(this.tileExist(z,v)){u.push(s[v][z])}}}}return u};this.tileExist=function(i,j){if(s[j]!==undefined&&(s[j][i] instanceof b)===true){return true}return false};this.drawImage=function(C,x,B,A,v,E,D,j,z){var u,w=0,y=0;if(A===undefined&&v===undefined){A=C.naturalWidth;v=C.naturalHeight}if(E===undefined&&D===undefined&&j===undefined&&z===undefined){x=parseInt(x,10);B=parseInt(B,10);A=parseInt(A,10);v=parseInt(v,10);u=this.getTilesToDraw(x,B,A,v)}else{E=parseInt(E,10);D=parseInt(D,10);j=parseInt(j,10);z=parseInt(z,10);u=this.getTilesToDraw(E,D,j,z)}y=u.length;for(w=0;w<y;w++){u[w].drawImage(C,x,B,A,v,E,D,j,z)}return this};this.clearRect=function(j,C,v,A){var u,z=0,B=0;u=this.getTilesToDraw(j,C,v,A);B=u.length;for(z=0;z<B;z++){u[z].clearRect(j,C,v,A)}return this}}if((a instanceof HTMLElement)===false){throw new Error("Container must be an instance of HTMLElement")}this.addLayer=function(i,k,j,h){if(typeof i!=="string"||i.length===0){throw new Error("Invalid name of the Layer: "+i)}if((e[i] instanceof f)===true){e[i].destroy();delete e[i]}if(k===undefined){d+=1;k=d}else{k=parseInt(k,10);if(d<k){d=k}}e[i]=new f(a,i,k,(j===undefined)?g.tile.width:j,(h===undefined)?g.tile.height:h);if(k===d){c=e[i]}return this};this.getLayer=function(h){return((e[h] instanceof f)===false)?e:e[h]};this.drawImage=function(n,j,m,l,i,p,o,h,k){if((c instanceof f)===false){throw new Error("No layers in this canvas, add at least one layer")}c.drawImage(n,j,m,l,i,p,o,h,k)};this.clearRect=function(i,l,j,k){if((c instanceof f)===false){throw new Error("No layers in this canvas, add at least one layer")}c.clearRect(i,l,j,k)}};